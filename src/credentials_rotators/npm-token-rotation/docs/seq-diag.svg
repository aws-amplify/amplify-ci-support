<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="882px" preserveAspectRatio="none" style="width:1008px;height:882px;" version="1.1" viewBox="0 0 1008 882" width="1008px" zoomAndPan="magnify"><defs><filter height="300%" id="fh5llumzmtf0m" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="64" x2="64" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="216" x2="216" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="377" x2="377" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="498" x2="498" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="596" x2="596" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="733" x2="733" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="841" x2="841" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="911" x2="911" y1="88.29" y2="798.4399"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="971" x2="971" y1="88.29" y2="798.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="5" y="85.3027">Secrets Manager</text><ellipse cx="64.5" cy="15" fill="#FEFECE" filter="url(#fh5llumzmtf0m)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M64.5,23 L64.5,50 M51.5,31 L77.5,31 M64.5,50 L51.5,65 M64.5,50 L77.5,65 " fill="none" filter="url(#fh5llumzmtf0m)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="5" y="810.7427">Secrets Manager</text><ellipse cx="64.5" cy="823.73" fill="#FEFECE" filter="url(#fh5llumzmtf0m)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M64.5,831.73 L64.5,858.73 M51.5,839.73 L77.5,839.73 M64.5,858.73 L51.5,873.73 M64.5,858.73 L77.5,873.73 " fill="none" filter="url(#fh5llumzmtf0m)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="123" x="153" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="160" y="73.3027">Rotator Lambda</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="123" x="153" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="160" y="817.7427">Rotator Lambda</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="170" x="290" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="156" x="297" y="73.3027">Rotation Step Function</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="170" x="290" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="156" x="297" y="817.7427">Rotation Step Function</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="474" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="481" y="73.3027">NPM</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="474" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="481" y="817.7427">NPM</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="125" x="532" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="539" y="73.3027">Token Publisher</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="125" x="532" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="539" y="817.7427">Token Publisher</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="121" x="671" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="678" y="73.3027">Token Remover</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="121" x="671" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="678" y="817.7427">Token Remover</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="67" x="806" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="813" y="73.3027">CircleCI</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="67" x="806" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="813" y="817.7427">CircleCI</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="887" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="894" y="73.3027">NPM</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="887" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="894" y="817.7427">NPM</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="49" x="945" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="952" y="73.3027">Slack</text><rect fill="#FEFECE" filter="url(#fh5llumzmtf0m)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="49" x="945" y="797.4399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="952" y="817.7427">Slack</text><polygon fill="#A80036" points="204.5,115.4165,214.5,119.4165,204.5,123.4165,208.5,119.4165" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="210.5" y1="119.4165" y2="119.4165"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="71.5" y="114.6426">createSecret</text><polygon fill="#A80036" points="75.5,144.543,65.5,148.543,75.5,152.543,71.5,148.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="69.5" x2="215.5" y1="148.543" y2="148.543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="81.5" y="143.769">Get NPM Credentials</text><polygon fill="#A80036" points="204.5,158.543,214.5,162.543,204.5,166.543,208.5,162.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="210.5" y1="162.543" y2="162.543"/><polygon fill="#A80036" points="486,187.6694,496,191.6694,486,195.6694,490,191.6694" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="216.5" x2="492" y1="191.6694" y2="191.6694"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="223.5" y="186.8955">create new token</text><polygon fill="#A80036" points="227.5,201.6694,217.5,205.6694,227.5,209.6694,223.5,205.6694" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="221.5" x2="497" y1="205.6694" y2="205.6694"/><polygon fill="#A80036" points="75.5,215.6694,65.5,219.6694,75.5,223.6694,71.5,219.6694" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69.5" x2="215.5" y1="219.6694" y2="219.6694"/><polygon fill="#A80036" points="204.5,244.7959,214.5,248.7959,204.5,252.7959,208.5,248.7959" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="210.5" y1="248.7959" y2="248.7959"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="71.5" y="244.022">setSecret</text><polygon fill="#A80036" points="75.5,258.7959,65.5,262.7959,75.5,266.7959,71.5,262.7959" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69.5" x2="215.5" y1="262.7959" y2="262.7959"/><polygon fill="#A80036" points="204.5,287.9224,214.5,291.9224,204.5,295.9224,208.5,291.9224" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="210.5" y1="291.9224" y2="291.9224"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="71.5" y="287.1484">testSecret</text><polygon fill="#A80036" points="899,317.0488,909,321.0488,899,325.0488,903,321.0488" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="216.5" x2="905" y1="321.0488" y2="321.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="223.5" y="316.2749">validate token</text><polygon fill="#A80036" points="227.5,331.0488,217.5,335.0488,227.5,339.0488,223.5,335.0488" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="221.5" x2="910" y1="335.0488" y2="335.0488"/><polygon fill="#A80036" points="365,360.1753,375,364.1753,365,368.1753,369,364.1753" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="371" y1="364.1753" y2="364.1753"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="71.5" y="359.4014">finishSecrets</text><polygon fill="#A80036" points="365,389.3018,375,393.3018,365,397.3018,369,393.3018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="216.5" x2="371" y1="393.3018" y2="393.3018"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="223.5" y="388.5278">initiate step function</text><polygon fill="#A80036" points="227.5,403.3018,217.5,407.3018,227.5,411.3018,223.5,407.3018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="221.5" x2="376" y1="407.3018" y2="407.3018"/><polygon fill="#A80036" points="584.5,432.4282,594.5,436.4282,584.5,440.4282,588.5,436.4282" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="590.5" y1="436.4282" y2="436.4282"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="384" y="431.6543">Push token to CCI</text><polygon fill="#A80036" points="75.5,461.5547,65.5,465.5547,75.5,469.5547,71.5,465.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="69.5" x2="595.5" y1="465.5547" y2="465.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="81.5" y="460.7808">Get new token</text><polygon fill="#A80036" points="584.5,475.5547,594.5,479.5547,584.5,483.5547,588.5,479.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="590.5" y1="479.5547" y2="479.5547"/><polygon fill="#A80036" points="829.5,504.6812,839.5,508.6812,829.5,512.6812,833.5,508.6812" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="596.5" x2="835.5" y1="508.6812" y2="508.6812"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="603.5" y="503.9072">Publish token</text><polygon fill="#A80036" points="607.5,518.6812,597.5,522.6812,607.5,526.6812,603.5,522.6812" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="601.5" x2="840.5" y1="522.6812" y2="522.6812"/><polygon fill="#A80036" points="388,532.6812,378,536.6812,388,540.6812,384,536.6812" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="595.5" y1="536.6812" y2="536.6812"/><polygon fill="#A80036" points="959.5,561.8076,969.5,565.8076,959.5,569.8076,963.5,565.8076" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="965.5" y1="565.8076" y2="565.8076"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="384" y="561.0337">send rotation notification</text><polygon fill="#A80036" points="388,575.8076,378,579.8076,388,583.8076,384,579.8076" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="970.5" y1="579.8076" y2="579.8076"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="419" y1="608.9341" y2="608.9341"/><line style="stroke:#A80036;stroke-width:1.0;" x1="419" x2="419" y1="608.9341" y2="621.9341"/><line style="stroke:#A80036;stroke-width:1.0;" x1="378" x2="419" y1="621.9341" y2="621.9341"/><polygon fill="#A80036" points="388,617.9341,378,621.9341,388,625.9341,384,621.9341" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="384" y="604.1602">Wait 15 mins</text><polygon fill="#A80036" points="721.5,647.0605,731.5,651.0605,721.5,655.0605,725.5,651.0605" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="727.5" y1="651.0605" y2="651.0605"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="384" y="646.2866">delete rotated token</text><polygon fill="#A80036" points="75.5,676.187,65.5,680.187,75.5,684.187,71.5,680.187" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="69.5" x2="732.5" y1="680.187" y2="680.187"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="81.5" y="675.4131">Get NPM Credentials and old token</text><polygon fill="#A80036" points="509,705.3135,499,709.3135,509,713.3135,505,709.3135" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="732.5" y1="709.3135" y2="709.3135"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="515" y="704.5396">Delete token</text><polygon fill="#A80036" points="721.5,719.3135,731.5,723.3135,721.5,727.3135,725.5,723.3135" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="498" x2="727.5" y1="723.3135" y2="723.3135"/><polygon fill="#A80036" points="388,733.3135,378,737.3135,388,741.3135,384,737.3135" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="732.5" y1="737.3135" y2="737.3135"/><polygon fill="#A80036" points="959.5,762.4399,969.5,766.4399,959.5,770.4399,963.5,766.4399" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="965.5" y1="766.4399" y2="766.4399"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="384" y="761.666">send notification</text><polygon fill="#A80036" points="388,776.4399,378,780.4399,388,784.4399,384,780.4399" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="970.5" y1="780.4399" y2="780.4399"/><!--MD5=[6df03a1d5a8ed1ac3c9feb2447868a4b]
@startuml
actor "Secrets Manager" as SM
participant "Rotator Lambda" as RM
participant "Rotation Step Function" as SF
participant "NPM" as npm
Participant "Token Publisher" as TP
Participant "Token Remover" as TR
participant "CircleCI" as cci

SM -> RM : createSecret
RM -> SM: Get NPM Credentials
SM - -> RM
RM -> npm: create new token
npm - -> RM:
RM - -> SM
SM -> RM: setSecret
RM - -> SM
SM -> RM: testSecret
RM -> NPM: validate token
NPM - -> RM


SM -> SF: finishSecrets
RM -> SF: initiate step function
SF - -> RM
SF -> TP: Push token to CCI
TP -> SM: Get new token
SM - -> TP
TP -> cci: Publish token
cci - ->TP
TP - -> SF
SF -> Slack: send rotation notification
Slack - -> SF

SF -> SF: Wait 15 mins

SF -> TR: delete rotated token
TR -> SM: Get NPM Credentials and old token
TR -> npm: Delete token
npm - -> TR
TR - -> SF
SF -> Slack: send notification
Slack - -> SF
@enduml

PlantUML version 1.2020.22(Sun Dec 06 09:36:27 UTC 2020)
(GPLV2 source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>