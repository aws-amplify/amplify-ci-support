<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="681px" preserveAspectRatio="none" style="width:788px;height:681px;" version="1.1" viewBox="0 0 788 681" width="788px" zoomAndPan="magnify"><defs><filter height="300%" id="f1c7aohuzmeb4c" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="64" x2="64" y1="88.29" y2="596.8076"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="197" x2="197" y1="88.29" y2="596.8076"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="358" x2="358" y1="88.29" y2="596.8076"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="509" x2="509" y1="88.29" y2="596.8076"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="578" x2="578" y1="88.29" y2="596.8076"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="648" x2="648" y1="88.29" y2="596.8076"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="708" x2="708" y1="88.29" y2="596.8076"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="761" x2="761" y1="88.29" y2="596.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="5" y="85.3027">Secrets Manager</text><ellipse cx="64.5" cy="15" fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M64.5,23 L64.5,50 M51.5,31 L77.5,31 M64.5,50 L51.5,65 M64.5,50 L77.5,65 " fill="none" filter="url(#f1c7aohuzmeb4c)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="5" y="609.1104">Secrets Manager</text><ellipse cx="64.5" cy="622.0977" fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M64.5,630.0977 L64.5,657.0977 M51.5,638.0977 L77.5,638.0977 M64.5,657.0977 L51.5,672.0977 M64.5,657.0977 L77.5,672.0977 " fill="none" filter="url(#f1c7aohuzmeb4c)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="123" x="134" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="141" y="73.3027">Rotator Lambda</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="123" x="134" y="595.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="141" y="616.1104">Rotator Lambda</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="170" x="271" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="156" x="278" y="73.3027">Rotation Step Function</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="170" x="271" y="595.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="156" x="278" y="616.1104">Rotation Step Function</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="485" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="492" y="73.3027">NPM</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="485" y="595.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="492" y="616.1104">NPM</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="67" x="543" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="550" y="73.3027">CircleCI</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="67" x="543" y="595.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="550" y="616.1104">CircleCI</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="624" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="631" y="73.3027">NPM</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="44" x="624" y="595.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="631" y="616.1104">NPM</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="49" x="682" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="689" y="73.3027">Slack</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="49" x="682" y="595.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="689" y="616.1104">Slack</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="29" x="745" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="752" y="73.3027">sa</text><rect fill="#FEFECE" filter="url(#f1c7aohuzmeb4c)" height="30.29" style="stroke:#A80036;stroke-width:1.5;" width="29" x="745" y="595.8076"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="752" y="616.1104">sa</text><polygon fill="#A80036" points="185.5,115.4165,195.5,119.4165,185.5,123.4165,189.5,119.4165" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="191.5" y1="119.4165" y2="119.4165"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="71.5" y="114.6426">createSecret</text><polygon fill="#A80036" points="497,144.543,507,148.543,497,152.543,501,148.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="197.5" x2="503" y1="148.543" y2="148.543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="204.5" y="143.769">create new token</text><polygon fill="#A80036" points="208.5,158.543,198.5,162.543,208.5,166.543,204.5,162.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202.5" x2="508" y1="162.543" y2="162.543"/><polygon fill="#A80036" points="75.5,172.543,65.5,176.543,75.5,180.543,71.5,176.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69.5" x2="196.5" y1="176.543" y2="176.543"/><polygon fill="#A80036" points="185.5,201.6694,195.5,205.6694,185.5,209.6694,189.5,205.6694" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="191.5" y1="205.6694" y2="205.6694"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="71.5" y="200.8955">setSecret</text><polygon fill="#A80036" points="75.5,215.6694,65.5,219.6694,75.5,223.6694,71.5,219.6694" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69.5" x2="196.5" y1="219.6694" y2="219.6694"/><polygon fill="#A80036" points="185.5,244.7959,195.5,248.7959,185.5,252.7959,189.5,248.7959" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="191.5" y1="248.7959" y2="248.7959"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="71.5" y="244.022">testSecret</text><polygon fill="#A80036" points="636,273.9224,646,277.9224,636,281.9224,640,277.9224" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="197.5" x2="642" y1="277.9224" y2="277.9224"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="204.5" y="273.1484">validate token</text><polygon fill="#A80036" points="208.5,287.9224,198.5,291.9224,208.5,295.9224,204.5,291.9224" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202.5" x2="647" y1="291.9224" y2="291.9224"/><polygon fill="#A80036" points="346,317.0488,356,321.0488,346,325.0488,350,321.0488" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64.5" x2="352" y1="321.0488" y2="321.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="71.5" y="316.2749">finishSecrets</text><polygon fill="#A80036" points="346,346.1753,356,350.1753,346,354.1753,350,350.1753" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="197.5" x2="352" y1="350.1753" y2="350.1753"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="204.5" y="345.4014">initiate step function</text><polygon fill="#A80036" points="208.5,360.1753,198.5,364.1753,208.5,368.1753,204.5,364.1753" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202.5" x2="357" y1="364.1753" y2="364.1753"/><polygon fill="#A80036" points="566.5,389.3018,576.5,393.3018,566.5,397.3018,570.5,393.3018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="572.5" y1="393.3018" y2="393.3018"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="365" y="388.5278">push new NPM token</text><polygon fill="#A80036" points="369,403.3018,359,407.3018,369,411.3018,365,407.3018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="363" x2="577.5" y1="407.3018" y2="407.3018"/><polygon fill="#A80036" points="696.5,432.4282,706.5,436.4282,696.5,440.4282,700.5,436.4282" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="702.5" y1="436.4282" y2="436.4282"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="365" y="431.6543">send rotation notification</text><polygon fill="#A80036" points="369,446.4282,359,450.4282,369,454.4282,365,450.4282" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="363" x2="707.5" y1="450.4282" y2="450.4282"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="400" y1="479.5547" y2="479.5547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="400" x2="400" y1="479.5547" y2="492.5547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="359" x2="400" y1="492.5547" y2="492.5547"/><polygon fill="#A80036" points="369,488.5547,359,492.5547,369,496.5547,365,492.5547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="365" y="474.7808">Wait 15 mins</text><polygon fill="#A80036" points="497,517.6812,507,521.6812,497,525.6812,501,521.6812" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="503" y1="521.6812" y2="521.6812"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="365" y="516.9072">delete rotated token</text><polygon fill="#A80036" points="369,531.6812,359,535.6812,369,539.6812,365,535.6812" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="363" x2="508" y1="535.6812" y2="535.6812"/><polygon fill="#A80036" points="696.5,560.8076,706.5,564.8076,696.5,568.8076,700.5,564.8076" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="702.5" y1="564.8076" y2="564.8076"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="365" y="560.0337">send notification</text><polygon fill="#A80036" points="369,574.8076,359,578.8076,369,582.8076,365,578.8076" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="363" x2="707.5" y1="578.8076" y2="578.8076"/><!--MD5=[ee886542225b37613236a67a3bd85a7b]
@startuml
actor "Secrets Manager" as SM
participant "Rotator Lambda" as RM
participant "Rotation Step Function" as SF
participant "NPM" as npm
participant "CircleCI" as cci

SM -> RM : createSecret
RM -> npm: create new token
npm - -> RM:
RM - -> SM
SM -> RM: setSecret
RM - -> SM
SM -> RM: testSecret
RM -> NPM: validate token
NPM - -> RM


SM -> SF: finishSecrets
RM -> SF: initiate step function
SF - -> RM
SF -> cci: push new NPM token
cci - -> SF
SF -> Slack: send rotation notification
Slack - -> SF

SF -> SF: Wait 15 mins
SF -> npm: delete rotated token
npm - -> SF
SF -> Slack: send notification
Slack - -> SF

deactivate sa
@enduml

PlantUML version 1.2020.22(Sun Dec 06 09:36:27 UTC 2020)
(GPLV2 source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>